<div class='container'>
  <div class='row'>
    <div class="col-sm-12 col-md-8 col-lg-5 px-5 px-sm-0 mx-auto">
      <table class='table table-hover table-inverse'>
        <h1>グループの詳細</h1>
        <thead>
          <tr>
            <th></th>
            <th>グループ名</th>
            <th>紹介文</th>
            <th colspan="3"></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <% if @group.group_image.attached? %>
                <%= image_tag @group.group_image,size:"50x50" %>
              <% else %>
                <%= image_tag 'no_image', size: "50x50" %>
              <% end %>
            </td>
            </td>
            <td><%= @group.name %></td>
            <td><%= @group.introduction %></td>
            <td>
              <% if @group.is_owned_by?(current_player) %>
              <% elsif @group.group_players.exists?(player_id: current_player.id) %>
              　<%= link_to 'グループ退出', public_group_group_players_path(@group), method: :delete, class: "btn btn-sm btn-danger", data: { confirm: "本当にグループを退出しますか？" } %>
              <% elsif @group.group_approvals.exists?(player_id: current_player.id) %>
                <%= link_to '申請取消', public_group_group_approvals_path(@group), method: :delete, class: "btn btn-sm btn-danger" %>
              <% else %>
              　<%= link_to '加入申請', new_public_group_group_approvals_path(@group), class: "btn btn-sm btn-success" %>
              <% end %>
            </td>
            <%# byebug %>
          </tr>
        </tbody>
      </table>

      <% if @group.owner_id == current_player.id %>
        <div class="dropdown">
          <button class="btn btn-sm btn-secondary dropdown-toggle"
            type="button" id="dropdownMenu1" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            オーナー専用
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <%= link_to "承認待ち一覧", public_approvals_path(@group),  class: "dropdown-item text-secondary bg-transparent" %>
          <%= link_to 'グループ編集', edit_public_group_path(@group), class:  "dropdown-item text-secondary bg-transparent" %>
          <%= link_to 'グループ削除', public_group_path(@group), method: :delete, class:  "dropdown-item text-secondary bg-transparent", data: { confirm: "本当にグループを削除しますか？" } %>
        </div>
        </div>
      <% end %>
    </div>
    <table class='table table-hover table-inverse'>

      <tr>
        <th>ニックネーム</th>

      </tr>
        <% @group.players.each do |player| %>
      <tr>
        <td><%= player.nickname %></td>
        <% if GroupApproval.exists?(player_id: player.id, group_id: @group.id) %>
        <% approval=player.group_approvals.find_by(group_id: @group.id) %>
          <td><%= approval.status_i18n %></td>
          <td class="text-right">
            <%= link_to '申請中', public_group_group_approvals_path(@group, approval_id: approval.id,status:"applying"), method: :patch, class: "btn btn-sm btn-success" %>
            <%= link_to '承認', public_group_group_approvals_path(@group, approval_id: approval.id,status:"approval"), method: :patch, class: "btn btn-sm btn-success" %>
            <%= link_to '却下', public_group_group_approvals_path(@group, approval_id: approval.id,status:"rejected"), method: :delete, class: "btn btn-sm btn-success" %>
          </td>
        <% else %>
          <td><%= link_to '加入申請', new_public_group_group_approvals_path(@group), class: "btn btn-sm btn-success" %></td>
        <% end %>
      </tr>
      <% end %>
    </table>
  </div>
</div>